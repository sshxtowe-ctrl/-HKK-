<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>#Hkk ‚Äî ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏Ñ‡∏£‡πÉ‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Æ‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏¥</title>
<style>
  :root{
    --bg:#0b0b0b; --card:#111; --accent:#e53935; --muted:#cfcfcf;
    --white:#fff; --red:#e53935; --black:#000;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: "Prompt", "Noto Sans Thai", sans-serif;
    background:linear-gradient(180deg,#070707,var(--bg));
    color:var(--white); display:flex; align-items:center; justify-content:center; min-height:100vh;
    padding:20px;
  }
  .wrap{width:100%; max-width:900px;}
  header{text-align:center;margin-bottom:14px}
  h1{margin:0;font-size:22px;color:var(--red);text-shadow:0 0 10px #ff7f7f44}
  .sub{color:var(--muted);margin-top:6px;font-size:14px}
  .card{background:linear-gradient(180deg,#0f0f0f,#151515); border:1px solid rgba(255,255,255,0.03);
        padding:18px;border-radius:12px; box-shadow:0 12px 40px rgba(0,0,0,0.6);}
  .qnum{font-size:13px;color:var(--muted);margin-bottom:8px}
  .qtitle{font-weight:700;margin:8px 0 12px}
  .opts{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;}
  .opt{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);
       padding:12px;border-radius:10px;cursor:pointer;transition:all .15s;font-weight:600}
  .opt:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(229,57,53,0.12);background:rgba(229,57,53,0.06)}
  .controls{display:flex;gap:8px;margin-top:14px;flex-wrap:wrap}
  .btn{background:var(--red);color:var(--white);border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
  .progress{height:8px;background:#0c0c0c;border-radius:8px;overflow:hidden;margin-top:12px}
  .progress > i{display:block;height:100%;width:0;background:linear-gradient(90deg,#ff8a80,#e53935);transition:width .45s ease}
  #result{margin-top:18px;padding:16px;border-radius:12px;background:linear-gradient(180deg,#0e0e0e,#121212);
          border:1px solid rgba(229,57,53,0.12);display:none}
  .res-row{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}
  .res-card{flex:1;min-width:220px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02)}
  .emoji{font-size:40px;margin-bottom:6px}
  .rtitle{font-weight:800;font-size:16px;margin-bottom:6px;color:var(--red)}
  .rdesc{color:var(--muted);line-height:1.5;font-size:14px}
  .credit{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}
  @media(max-width:640px){.opts{grid-template-columns:1fr}.res-row{flex-direction:column}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>üî¥‚ö´‚ö™ #Hkk ‚Äî ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏Ñ‡∏£‡πÉ‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Æ‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏¥</h1>
    <div class="sub">‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏π‡∏ú‡∏•‡∏ó‡∏±‡πâ‡∏á ‚Äú‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‚Äù ‡πÅ‡∏•‡∏∞ ‚Äú‡πÅ‡∏Å‡πä‡∏á‚Äù ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‚Äî ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÇ‡∏î‡∏¢ <b>lullmorien</b></div>
  </header>

  <div class="card" id="card">
    <div class="qnum" id="qnum">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 1 / 5</div>
    <div class="qtitle" id="qtitle">...</div>

    <div class="opts" id="opts"></div>

    <div class="progress" aria-hidden="true"><i id="bar"></i></div>

    <div class="controls">
      <button class="btn ghost" id="btnPrev" style="display:none">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
      <button class="btn" id="btnSkip">‡∏Ç‡πâ‡∏≤‡∏°</button>
    </div>

    <div id="result"></div>
    <div class="credit">‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÇ‡∏î‡∏¢ <b>lullmorien</b></div>
  </div>
</div>

<script>
/* ---------- synth click (simple) ---------- */
function playClick(){
  try{
    const ctx = window._hhAudioCtx || (window._hhAudioCtx = new (window.AudioContext||window.webkitAudioContext)());
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = 'sine';
    o.frequency.value = 800;
    g.gain.value = 0.0001;
    o.connect(g); g.connect(ctx.destination);
    o.start();
    g.gain.linearRampToValueAtTime(0.12, ctx.currentTime + 0.005);
    g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.12);
    setTimeout(()=>{ o.stop(); o.disconnect(); g.disconnect(); },160);
  }catch(e){}
}

/* ---------- questions + mapping to two result axes ---------- */
/*
 We will map each option to:
  - a "type" key (4 human / 4 yokai combined into 8 codes)
  - a "gang" key (4 gang codes: akito, yoichi, manasa, sayuri)
*/

const questions = [
  {
    q: "‡πÄ‡∏à‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡∏´‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏ï‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÑ‡∏á?",
    o: [
      {t:'human_cautious', g:'akito', txt:"‡πÑ‡∏°‡πà‡∏¢‡∏∏‡πà‡∏á ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ"},
      {t:'human_curious', g:'manasa', txt:"‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏õ‡∏î‡∏π‚Ä¶ ‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£"},
      {t:'yokai_mischief', g:'yoichi', txt:"‡∏ä‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏ô‡∏∏‡∏Å"},
      {t:'yokai_calm', g:'akito', txt:"‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏õ‡πÅ‡∏ö‡∏ö‡∏ô‡∏¥‡πà‡∏á ‡πÜ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏≠‡∏∞‡πÑ‡∏£"}
    ]
  },
  {
    q: "‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ô‡∏£‡πâ‡∏≠‡∏á‡πÑ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‚Ä¶?",
    o: [
      {t:'human_cautious', g:'akito', txt:"‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏ñ‡∏≤‡∏°‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡πÑ‡∏´‡∏°"},
      {t:'human_curious', g:'manasa', txt:"‡∏¢‡∏∑‡∏ô‡∏ü‡∏±‡∏á‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡πÅ‡∏õ‡πä‡∏ö‚Ä¶ ‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á"},
      {t:'yokai_mischief', g:'yoichi', txt:"‡πÅ‡∏Å‡∏•‡πâ‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏î‡∏±‡∏á‡πÜ ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡∏≤‡∏´‡∏¢‡∏∏‡∏î‡∏£‡πâ‡∏≠‡∏á (‡∏Ç‡∏≥‡πÜ)"},
      {t:'yokai_calm', g:'sayuri', txt:"‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏õ‡∏ô‡∏±‡πà‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡πÜ ‡πÅ‡∏ö‡∏ö‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ"}
    ]
  },
  {
    q: "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ä‡∏ß‡∏ô‡πÑ‡∏õ‡∏•‡πà‡∏≤‡∏Ç‡πà‡∏≤‡∏ß‡∏•‡∏∑‡∏≠‡πÇ‡∏¢‡πÑ‡∏Ñ ‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö‡∏ß‡πà‡∏≤?",
    o: [
      {t:'yokai_scared', g:'akito', txt:"‡πÑ‡∏°‡πà‡πÑ‡∏õ ‡∏Å‡∏•‡∏±‡∏ß‡πÄ‡∏à‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏î‡∏µ"},
      {t:'human_curious', g:'manasa', txt:"‡πÑ‡∏õ‡∏™‡∏¥! ‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏°‡∏≤‡∏Å‡∏Å"},
      {t:'yokai_mischief', g:'yoichi', txt:"‡πÑ‡∏õ‡πÅ‡∏Å‡∏•‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡∏ó‡∏≤‡∏á‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤"},
      {t:'yokai_calm', g:'sayuri', txt:"‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡πÑ‡∏õ‡πÅ‡∏ö‡∏ö‡∏ô‡∏¥‡πà‡∏á ‡πÜ"}
    ]
  },
  {
    q: "‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏°‡πÇ‡∏´ ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡∏Å‡∏à‡∏∞‚Ä¶",
    o: [
      {t:'human_cautious', g:'akito', txt:"‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏ô‡∏µ‡πÑ‡∏õ‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏ï‡∏¥"},
      {t:'yokai_playful', g:'yoichi', txt:"‡∏û‡∏π‡∏î‡∏à‡∏≤‡πÅ‡∏ã‡∏ß‡πÅ‡∏£‡∏á‡πÜ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏±‡∏á"},
      {t:'human_hot', g:'manasa', txt:"‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ ‡πÅ‡∏ï‡πà‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô"},
      {t:'yokai_calm', g:'sayuri', txt:"‡∏¢‡∏¥‡πâ‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏π‡∏î‡∏à‡∏µ‡πâ‡πÉ‡∏à‡∏î‡∏≥‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡∏†‡∏≤‡∏û"}
    ]
  },
  {
    q: "‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ô‡πÅ‡∏õ‡∏•‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≤‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‚Ä¶",
    o: [
      {t:'human_cautious', g:'akito', txt:"‡∏ä‡πà‡∏ß‡∏¢ ‡πÅ‡∏ï‡πà‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏ï‡∏±‡∏ß"},
      {t:'human_curious', g:'manasa', txt:"‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏•‡∏∞‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡πÉ‡∏´‡πâ‡∏•‡∏∂‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô"},
      {t:'yokai_mischief', g:'yoichi', txt:"‡πÅ‡∏Å‡∏•‡πâ‡∏á‡∏ñ‡∏≤‡∏°‡πÄ‡∏•‡πà‡∏ô‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏£‡∏¥‡∏á‡πÜ"},
      {t:'yokai_calm', g:'sayuri', txt:"‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏ö‡∏ö‡∏ô‡∏¥‡πà‡∏á‡πÜ ‡πÅ‡∏ï‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ"}
    ]
  }
];

/* ---------- result definitions ---------- */
const typeDefs = {
  human_cautious: {
    title: "‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏™‡∏≤‡∏¢‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á",
    emoji: "üõ°Ô∏è",
    desc: "‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô ‡∏™‡∏∏‡∏†‡∏≤‡∏û ‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á ‡∏ä‡∏≠‡∏ö‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏ï‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠"
  },
  human_curious: {
    title: "‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏ä‡∏≠‡∏ö‡∏™‡∏≥‡∏£‡∏ß‡∏à",
    emoji: "üîé",
    desc: "‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ ‡∏ä‡∏≠‡∏ö‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏Ç‡πà‡∏≤‡∏ß‡∏•‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏•‡∏µ‡πâ‡∏•‡∏±‡∏ö ‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡∏Å‡πá‡∏ï‡∏¥‡∏î‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏à‡∏ô‡πÅ‡∏™‡∏ö‡πÜ"
  },
  human_hot: {
    title: "‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏´‡∏±‡∏ß‡∏£‡πâ‡∏≠‡∏ô‡πÅ‡∏ï‡πà‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à",
    emoji: "üî•",
    desc: "‡πÇ‡∏ú‡∏á‡∏ú‡∏≤‡∏á‡∏ö‡πâ‡∏≤‡∏á ‡πÅ‡∏ï‡πà‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à ‡πÅ‡∏•‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏π‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÇ‡∏Å‡∏£‡∏ò‡πÄ‡∏£‡πá‡∏ß‡∏Å‡πá‡∏à‡∏£‡∏¥‡∏á"
  },
  yokai_scared: {
    title: "‡πÇ‡∏¢‡πÑ‡∏Ñ‡∏Ç‡∏µ‡πâ‡∏Å‡∏•‡∏±‡∏ß",
    emoji: "üòø",
    desc: "‡∏ï‡∏Å‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏ï‡πà‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô ‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡∏±‡∏ß‡∏Å‡πá‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô"
  },
  yokai_mischief: {
    title: "‡πÇ‡∏¢‡πÑ‡∏Ñ‡πÄ‡∏à‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏´‡πå",
    emoji: "üòº",
    desc: "‡∏Ç‡∏µ‡πâ‡πÄ‡∏•‡πà‡∏ô ‡∏Ç‡∏µ‡πâ‡πÅ‡∏Å‡∏•‡πâ‡∏á ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏¢ ‡∏ä‡∏≠‡∏ö‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏™‡∏ô‡∏∏‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô"
  },
  yokai_calm: {
    title: "‡πÇ‡∏¢‡πÑ‡∏Ñ‡∏≠‡πà‡∏≠‡∏ô‡πÇ‡∏¢‡∏ô‡πÄ‡∏á‡∏µ‡∏¢‡∏ö ‡πÜ",
    emoji: "üåô",
    desc: "‡∏ô‡∏¥‡πà‡∏á ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏î‡∏µ ‡πÉ‡∏à‡∏•‡∏∂‡∏Å ‡∏°‡∏µ‡πÄ‡∏™‡∏ô‡πà‡∏´‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ"
  },
  yokai_playful: {
    title: "‡πÇ‡∏¢‡πÑ‡∏Ñ‡∏ï‡∏¥‡πä‡∏á‡∏ï‡πä‡∏≠‡∏á/‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏ô‡∏∏‡∏Å",
    emoji: "üé≠",
    desc: "‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏î‡∏µ ‡∏ä‡∏≠‡∏ö‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏≤‡∏∞‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô"
  }
};

const gangDefs = {
  akito: {
    name: "‡πÅ‡∏Å‡πä‡∏á‡∏≠‡∏≤‡∏Ñ‡∏¥‡πÇ‡∏ï‡∏∞ ‚Äî ‡∏™‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏¢‡∏π‡πÄ‡∏£‡∏¢‡πå)",
    emoji: "üåï",
    desc: "‡∏ô‡∏¥‡πà‡∏á ‡∏™‡∏∏‡∏†‡∏≤‡∏û ‡∏≠‡πà‡∏≠‡∏ô‡πÇ‡∏¢‡∏ô ‡∏ä‡∏≠‡∏ö‡∏°‡∏∏‡∏°‡∏™‡∏á‡∏ö ‡∏°‡∏≠‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡πÄ‡∏á‡∏µ‡∏¢‡∏ö ‡πÜ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å"
  },
  yoichi: {
    name: "‡πÅ‡∏Å‡πä‡∏á‡πÇ‡∏¢‡∏≠‡∏¥‡∏à‡∏¥ ‚Äî ‡∏£‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô (‡∏ó‡∏≤‡∏ô‡∏π‡∏Å‡∏¥)",
    emoji: "ü¶ù",
    desc: "‡∏™‡∏∏‡∏†‡∏≤‡∏û‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏°‡∏∏‡∏Å ‡∏Ç‡∏µ‡πâ‡πÅ‡∏Å‡∏•‡πâ‡∏á‡πÉ‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å ‡πÄ‡∏Ñ‡∏£‡πà‡∏á‡∏Ñ‡∏£‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏•‡∏∂‡∏Å"
  },
  manasa: {
    name: "‡πÅ‡∏Å‡πä‡∏á‡∏°‡∏≤‡∏ô‡∏≤‡∏ã‡∏≤‡πÇ‡∏°‡∏∞ ‚Äî ‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏ü‡∏π‡∏à‡∏¥‡∏ô)",
    emoji: "üå¨Ô∏è",
    desc: "‡πÉ‡∏à‡∏î‡∏µ ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏π‡∏á ‡∏ä‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏Å‡∏ß‡∏ô‡∏ö‡πâ‡∏≤‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏ô‡∏¥‡∏ó ‡πÅ‡∏ï‡πà‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏±‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô"
  },
  sayuri: {
    name: "‡πÅ‡∏Å‡πä‡∏á‡∏ã‡∏≤‡∏¢‡∏π‡∏£‡∏¥ ‚Äî ‡πÄ‡∏•‡∏Ç‡∏≤ (‡∏¢‡∏π‡∏Å‡∏¥‡∏≠‡∏ô‡∏ô‡∏∞)",
    emoji: "‚ùÑÔ∏è",
    desc: "‡∏™‡∏∏‡∏†‡∏≤‡∏û ‡πÄ‡∏¢‡πá‡∏ô‡∏™‡∏ö‡∏≤‡∏¢ ‡∏°‡∏µ‡∏°‡∏∏‡∏°‡∏õ‡∏≤‡∏Å‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏±‡∏ß ‡πÅ‡∏ï‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏∏‡πà‡∏á‡∏°‡∏±‡πà‡∏ô"
  }
};

/* ---------- scoring state ---------- */
let typeScore = {}; // counts for type codes
let gangScore = {}; // counts for gang codes
let qIndex = 0;

/* ---------- render functions ---------- */
const qnumEl = document.getElementById('qnum');
const qtitleEl = document.getElementById('qtitle');
const optsEl = document.getElementById('opts');
const barEl = document.getElementById('bar');
const btnPrev = document.getElementById('btnPrev');
const btnSkip = document.getElementById('btnSkip');
const resultEl = document.getElementById('result');

function renderQuestion(i){
  const Q = questions[i];
  qnumEl.textContent = `‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ${i+1} / ${questions.length}`;
  qtitleEl.textContent = Q.q;
  optsEl.innerHTML = '';
  Q.o.forEach((opt, idx)=>{
    const d = document.createElement('div');
    d.className = 'opt';
    d.tabIndex = 0;
    d.innerHTML = `<strong>${String.fromCharCode(65+idx)}.</strong> ${opt.txt}`;
    d.onclick = ()=> choose(opt);
    d.onkeydown = (e)=>{ if(e.key==='Enter') choose(opt) };
    optsEl.appendChild(d);
  });
  barEl.style.width = `${Math.round((i)/questions.length*100)}%`;
  btnPrev.style.display = i>0 ? 'inline-block' : 'none';
}

function choose(opt){
  playClick();
  // increment scores
  typeScore[opt.t] = (typeScore[opt.t]||0) + 1;
  gangScore[opt.g] = (gangScore[opt.g]||0) + 1;
  // next
  qIndex++;
  if(qIndex >= questions.length) showResult();
  else renderQuestion(qIndex);
}

btnPrev.addEventListener('click', ()=>{
  if(qIndex>0){
    // can't easily revert exact previous mapping unless we track history ‚Äî simple: reset and replay history
    // To keep it simple we'll disable prev functionality for now (or implement history)
    // We'll implement history array to allow revert.
  }
});

/* implement history to allow prev */
let historyStack = [];
function chooseWithHistory(opt){
  playClick();
  historyStack.push(opt);
  typeScore[opt.t] = (typeScore[opt.t]||0) + 1;
  gangScore[opt.g] = (gangScore[opt.g]||0) + 1;
  qIndex++;
  if(qIndex >= questions.length) showResult();
  else renderQuestion(qIndex);
}
function undoLast(){
  if(historyStack.length===0) return;
  const last = historyStack.pop();
  typeScore[last.t] = Math.max(0,(typeScore[last.t]||0)-1);
  gangScore[last.g] = Math.max(0,(gangScore[last.g]||0)-1);
  qIndex = Math.max(0,qIndex-1);
  renderQuestion(qIndex);
}

/* attach chooseWithHistory to click handlers instead of choose */
function renderQuestionWithHistory(i){
  const Q = questions[i];
  qnumEl.textContent = `‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ${i+1} / ${questions.length}`;
  qtitleEl.textContent = Q.q;
  optsEl.innerHTML = '';
  Q.o.forEach((opt, idx)=>{
    const d = document.createElement('div');
    d.className = 'opt';
    d.tabIndex = 0;
    d.innerHTML = `<strong>${String.fromCharCode(65+idx)}.</strong> ${opt.txt}`;
    d.onclick = ()=> chooseWithHistory(opt);
    d.onkeydown = (e)=>{ if(e.key==='Enter') chooseWithHistory(opt) };
    optsEl.appendChild(d);
  });
  barEl.style.width = `${Math.round((i)/questions.length*100)}%`;
  btnPrev.style.display = i>0 ? 'inline-block' : 'none';
}

btnPrev.addEventListener('click', ()=>{
  undoLast();
});
btnSkip.addEventListener('click', ()=>{
  // skip increments nothing but advances (we'll record a neutral placeholder)
  playClick();
  historyStack.push({t:null,g:null});
  qIndex++;
  if(qIndex >= questions.length) showResult();
  else renderQuestionWithHistory(qIndex);
});

/* ---------- show result ---------- */
function pickTop(obj){
  // pick key with highest count; tie => random among top
  const entries = Object.entries(obj);
  if(entries.length===0) return null;
  let max = 0;
  entries.forEach(([k,v])=>{ if(v>max) max=v; });
  const top = entries.filter(([k,v])=>v===max).map(([k,v])=>k);
  return top[Math.floor(Math.random()*top.length)];
}

function showResult(){
  playClick();
  // finalize progress bar
  barEl.style.width = '100%';
  // determine type and gang
  const topType = pickTop(typeScore) || 'human_cautious';
  const topGangKey = pickTop(gangScore) || 'akito';

  const typeInfo = typeDefs[topType] || {title:'‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö', emoji:'‚ùî', desc:''};
  const gangInfo = gangDefs[topGangKey] || {name:'‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö', emoji:'‚ùî', desc:''};

  // build shareable URL params
  const loc = new URL(window.location.href);
  loc.searchParams.set('hh_type', topType);
  loc.searchParams.set('hh_gang', topGangKey);
  history.replaceState({}, '', loc);

  // render result
  resultEl.style.display = 'block';
  resultEl.innerHTML = `
    <div class="res-row">
      <div class="res-card">
        <div class="emoji">${typeInfo.emoji}</div>
        <div class="rtitle">${typeInfo.title}</div>
        <div class="rdesc">${typeInfo.desc}</div>
      </div>
      <div class="res-card">
        <div class="emoji">${gangInfo.emoji}</div>
        <div class="rtitle">${gangInfo.name}</div>
        <div class="rdesc">${gangInfo.desc}</div>
      </div>
    </div>
    <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn" id="shareBtn">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ú‡∏• / ‡πÅ‡∏ä‡∏£‡πå</button>
      <button class="btn ghost" id="replayBtn">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
    </div>
  `;

  document.getElementById('shareBtn').addEventListener('click', async ()=>{
    try{
      await navigator.clipboard.writeText(window.location.href);
      const btn = document.getElementById('shareBtn');
      btn.textContent = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß! ‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢';
      setTimeout(()=>btn.textContent='‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ú‡∏• / ‡πÅ‡∏ä‡∏£‡πå',1400);
    }catch(e){
      alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Äî ‡πÇ‡∏õ‡∏£‡∏î‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡πÄ‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà');
    }
  });
  document.getElementById('replayBtn').addEventListener('click', ()=>{
    // reset
    typeScore = {}; gangScore = {}; qIndex = 0; historyStack = [];
    resultEl.style.display = 'none';
    document.getElementById('result').innerHTML = '';
    renderQuestionWithHistory(0);
    const noLoc = new URL(window.location.href); noLoc.search = '';
    history.replaceState({}, '', noLoc);
  });
}

/* ---------- handle direct link with params ---------- */
function autoFromURL(){
  const params = new URLSearchParams(window.location.search);
  const t = params.get('hh_type');
  const g = params.get('hh_gang');
  if(t && g){
    // show result directly (no gameplay)
    const typeInfo = typeDefs[t] || {title:'‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö', emoji:'‚ùî', desc:''};
    const gangInfo = gangDefs[g] || {name:'‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö', emoji:'‚ùî', desc:''};
    resultEl.style.display = 'block';
    resultEl.innerHTML = `
      <div class="res-row">
        <div class="res-card">
          <div class="emoji">${typeInfo.emoji}</div>
          <div class="rtitle">${typeInfo.title}</div>
          <div class="rdesc">${typeInfo.desc}</div>
        </div>
        <div class="res-card">
          <div class="emoji">${gangInfo.emoji}</div>
          <div class="rtitle">${gangInfo.name}</div>
          <div class="rdesc">${gangInfo.desc}</div>
        </div>
      </div>
      <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" id="shareBtn">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ú‡∏• / ‡πÅ‡∏ä‡∏£‡πå</button>
        <button class="btn ghost" id="replayBtn">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
      </div>
    `;
    document.getElementById('shareBtn').addEventListener('click', async ()=>{
      try{ await navigator.clipboard.writeText(window.location.href); const b=document.getElementById('shareBtn'); b.textContent='‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!'; setTimeout(()=>b.textContent='‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ú‡∏• / ‡πÅ‡∏ä‡∏£‡πå',1400);}catch(e){alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');}
    });
    document.getElementById('replayBtn').addEventListener('click', ()=>{
      typeScore = {}; gangScore = {}; qIndex = 0; historyStack = [];
      resultEl.style.display = 'none'; document.getElementById('result').innerHTML = '';
      renderQuestionWithHistory(0);
      const noLoc = new URL(window.location.href); noLoc.search = ''; history.replaceState({}, '', noLoc);
    });
    return true;
  }
  return false;
}

/* ---------- init ---------- */
if(!autoFromURL()){
  renderQuestionWithHistory(0);
}
</script>
</body>
  </html>
